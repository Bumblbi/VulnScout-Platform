from sqlalchemy import Column, String, Integer, Text, Float, Enum, ForeignKey, JSON
from app.database import Base
import enum

class SeverityLevel(enum.Enum):
    INFO = "info"
    LOW = "low"
    MEDIUM = "medium"
    HIGH = "high"
    CRITICAL = "critical"

class Host(Base):
    __tablename__ = 'hosts'
    
    id = Column(Integer, primary_key=True)
    scan_id = Column(Integer, ForeignKey('scans.id'))
    ip_address = Column(String(45), nullable=False)
    hostname = Column(String(255))
    os_info = Column(JSON)
    status = Column(String(50))

class Port(Base):
    __tablename__ = 'ports'
    
    id = Column(Integer, primary_key=True)
    host_id = Column(Integer, ForeignKey('hosts.id'))
    port_number = Column(Integer, nullable=False)
    protocol = Column(String(10))
    service = Column(String(100))
    version = Column(String(255))
    state = Column(String(50))

class Vulnerability(Base):
    __tablename__ = 'vulnerabilities'
    
    id = Column(Integer, primary_key=True)
    scan_id = Column(Integer, ForeignKey('scans.id'))
    host_id = Column(Integer, ForeignKey('hosts.id'))
    port_id = Column(Integer, ForeignKey('ports.id'), nullable=True)
    title = Column(String(500), nullable=False)
    description = Column(Text)
    severity = Column(Enum(SeverityLevel), nullable=False)
    cve_id = Column(String(50))
    cvss_score = Column(Float)
    recommendation = Column(Text)
    proof = Column(Text)
    module_source = Column(String(100))
    fstek_id = Column(String(100))